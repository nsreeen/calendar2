<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<title>Page Title</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" type="text/css" href="https://www.neelsomani.com/projects/calendar/pretty-calendar-minified.css">
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="https://www.neelsomani.com/projects/calendar/pretty-calendar-minified.js"></script>
<style>
  html {
    box-sizing: border-box;
    margin: 0;
  }

  body {
    margin: 0;
    background-color: #333;
  }

  #editEventsPanel {
    margin: 20px;
    display: None;
  }

  #deletePanel {
    margin-top: 20px;
  }

  #getCalendarPanel {
    margin: 20px;
  }

</style>

<body>

  <div id="getCalendarPanel">
    Create a calendar!
    Name: <input id="calName">
    Start Time: <input id="calStartTime">
    End Time: <input id="calEndTime">
    RC token: <input id="rcToken">
    <button id="createCalendarSubmit">Submit</button>
  </div>

  <div id="createCalendarPanel">
    Load a calendar!
    Calendar token: <input id="calToken">
    <button id="getCalendarSubmit">Submit</button>
  </div>

  <div id="editEventsPanel">
    <div>
      Add an event!
      Summary: <input id="summary">
      Start: <input id="start">
      End: <input id="end">
      Day:<input id="day">
      <button id="submit">Submit</button>
    </div>

    <div id="deletePanel">
      Delete an event:
      Event ID: <input id="deleteId">
      <button id="delete">Delete</button>
    </div>
  </div>
  <div id="navWrap" style="width:70%;height:80%;position:absolute;top:30%;margin:100 auto;right:0;left:0;"></div>

  <script>
    function parseEvents(events) {
            let eventsToRender = [];
            for (let i = 0; i < events.length; i++) {
                  let dayOfWeek = events[i]["dayOfWeek"];
                  let summary = (events[i].id > 0) ? `${events[i]["summary"]} (id:${events[i]["id"]}` : events[i]["summary"];
                  let sd = new Date(events[i]["start"])
                  let start = `${sd.getHours() - 12}:${sd.getMinutes().toString().padStart(2, '0')}${sd.getHours() < 12 ? "am" : "pm"}`
                  let ed = new Date(events[i]["end"])
                  let end = `${ed.getHours() - 12}:${ed.getMinutes().toString().padStart(2, '0')}${ed.getHours() < 12 ? "am" : "pm"}`
                  eventsToRender.push([dayOfWeek, start, summary, "#c0c0c0", end]);
            }
            return eventsToRender
    }
    document.getElementById("getCalendarSubmit").addEventListener("click", function () {
          let calToken = document.getElementById("calToken").value;
          console.log(calToken);
          const xMLHttpRequest = new XMLHttpRequest();
          xMLHttpRequest.responseType = "json";
          xMLHttpRequest.open("GET", `http://0.0.0.0:8080/calendars/${calToken}`);
          xMLHttpRequest.send();
          xMLHttpRequest.onload = function () {
                console.log(xMLHttpRequest.response);
                let eventsToRender = parseEvents(xMLHttpRequest.response);
                var prettyCal = new PrettyCalendar(eventsToRender, "navWrap");
                document.getElementById("editEventsPanel").style.display = "block";
                document.getElementById("getCalendarPanel").style.display = "none";
          }
    })

    document.getElementById("submit").addEventListener("click", function () {
        const postHttp = new XMLHttpRequest()
        postHttp.open('POST', "http://0.0.0.0:8080/events")
        postHttp.setRequestHeader('Content-type', 'application/json')
        let data = {
              summary:document.getElementById("summary").value,
              start:document.getElementById("start").value,
              end:document.getElementById("end").value,
              day:document.getElementById("day").value,
              userId:1234
        }
        postHttp.send(JSON.stringify(data))
        postHttp.onload = function() {
            alert(postHttp.responseText)
        }
    })

    document.getElementById("delete").addEventListener("click", function () {
        const postHttp = new XMLHttpRequest()
        postHttp.open('DELETE', "http://0.0.0.0:8080/events")
        postHttp.setRequestHeader('Content-type', 'application/json')
        let data = {
              id:document.getElementById("deleteId").value,
        }

        postHttp.send(JSON.stringify(data))
        postHttp.onload = function() {
            alert(postHttp.responseText)
        }
    })

    document.getElementById("createCalendarSubmit").addEventListener("click", function () {
        const postHttp = new XMLHttpRequest()
        postHttp.open('POST', "http://0.0.0.0:8080/calendars")
        postHttp.setRequestHeader('Content-type', 'application/json')
        let data = {
              name:document.getElementById("calName").value,
              online:document.getElementById("calStartTime").value,
              offline:document.getElementById("calEndTime").value,
              rcToken:document.getElementById("rcToken").value,
        }
        postHttp.send(JSON.stringify(data))
        postHttp.onload = function() {
            alert(postHttp.responseText)
        }
    })

  </script>
</body>

</html>
